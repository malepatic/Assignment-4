<!doctype html>
<html lang="en">
<head>
    <title>Feedback</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<div id="container">
    
    <main>
        <h2>Feeback</h2>
        <h3>Love something? Hate something? Let us know!</h3>
        Note : Fields marked with an asterisk(*) are mandatory
        <br><br>
        <form method="post">
            <label>Title*:</label>
            <input type="radio" name="title" id="miss" value="miss" required="required"/>Miss
            <input type="radio" name="title" id="mr" value="mr" required="required"/>Mr.
            <input type="radio" name="title" id="mrs" value="mrs" required="required"/>Mrs.
            <br><br>
            <label for="firstName">First Name*:</label>
            <input type="text" name="firstName" id="firstName" placeholder="First Name" required/>
            <div id="firstName_error" style="color: red; display: none">Please enter first name.</div>
            <br><br>
            
            
            <label for="lastName">Last Name*:</label>
            <input type="text" name="lastName" id="lastName" placeholder="Last Name" required/>
            <div id="lastName_error" style="color: red; display: none">Please enter last name.</div>
            <br><br>
            
            
            <label for="emailId">Email Id*:</label>
            <input type="text" name="emailId" id="emailId" placeholder="yourname@domain.com" required/>
            <div id="emailId_error" style="color: red; display: none">Please enter valid email id.</div>
            <br><br>
            
            
            <label for="phoneNumber">Phone Number*:</label>
            <input type="text" name="phoneNumber" id="phoneNumber" placeholder="xxx-xxx-xxxx" required/>
            <div id="phoneNumber_error" style="color: red; display: none">Please enter valid phone number.</div>
            <br><br>
            
            <label for="streetAddress1">Street Address 1*:</label>
            <input type="text" name="streetAddress1" id="streetAddress1" placeholder="address" required/>
            <div id="streetAddress1_error" style="color: red; display: none">Please enter Address.</div>
            <br><br>
            
            <label for="streetAddress2">Street Address 2:</label>
            <input type="text" name="streetAddress2" id="streetAddress2" placeholder="address"/>
            <br><br>
            
            <label for="city">City*:</label>
            <input type="text" name="city" id="city" placeholder="city" required/>
            <div id="city_error" style="color: red; display: none">Please enter city.</div>
            <br><br>
            
            <label for="state">State*:</label>
            <input type="text" name="state" id="state" placeholder="state" required/>
            <div id="state_error" style="color: red; display: none">Please enter state.</div>
            <br><br>
            
            <label for="zipcode">ZipCode*:</label>
            <input type="text" name="zipcode" id="zipcode" placeholder="xxxxxx" required/>
            <div id="zipcode_error" style="color: red; display: none">Please enter valid zipcode.</div>
            <br><br>
            
            <label>How did you hear*:</label>
            <input type='checkbox' name="source" value="facebook"/> Facebook
            <input type='checkbox' name="source" value="google"/> Google
            <input type='checkbox' name="source" value="yelp"/> Yelp
            <div id="source_error" style="color: red; display: none">Please select how did you hear.</div>
            <br><br>
    
            <label for="drinks">Drink*</label>
            <select id="drinks" required name="drinks">
                <option value="">--Please choose a drink--</option>
                <option value="Berry">Berry burst</option>
                <option value="Peach">Peach sunshine</option>
                <option value="Choci">Choci</option>
                <option value="Cola">Cola</option>
                <option value="Pepsi">Pepsi</option>
            </select>
            <div id="drinks_error" style="display:none; color:red">Please select one drink.</div>
            <br><br>
            <label id="drink_name_label" for="drink_name_checkbox" style="display: none">Drink Name</label>
            <input type="checkbox" id="drink_name_checkbox" style="display: none">
            <br>
            <br>
            <label id="drink_custom_label" for="drink_custom_text" style="display: none">Any additional customizations*:</label>
            <textarea id="drink_custom_text" rows="5" cols="25" placeholder="Your Add ons, write no if none" style="display: none"></textarea>
            <div id="drink_custom_error" style="display:none; color:red">
                Please write add ons or no if none.
            </div>
            <br><br>
            <label for="comments">Comments*:</label>
            <textarea name="comments" id="comments" placeholder="Your comments" rows="5" cols="25" required></textarea>
            <div id="comments_error" style="color: red; display: none">Please enter your comments.</div>
            <br><br>
            <input id="submit" type="Submit" disabled>
            <input id="reset" type="Reset">
            <br><br>
        </form>
    </main>
</div>
<script>
    const emailId = /^(([^<>()[\]\\.,;:\s@']+(\.[^<>()[\]\\.,;:\s@']+)*)|('.+'))@northeastern.edu$/;
const phoneNumber = /\d{3}?\d{3}\d{4}$/;
const zipcode = /^[0-9]{5}(?:-[0-9]{4})?$/;

const inputRegExs = {emailId, phoneNumber, zipcode};
const submitBtn = document.getElementById('submit');
const resetBtn = document.getElementById('reset');

const formElement = document.getElementsByTagName('form')[0];

const isValidForm = {
    'firstName': false, 'lastName': false,'emailId': false, 'phoneNumber': false,
    'streetAddress1': false,'city': false, 'state': false,
    'zipcode': false,'source': false,'drinks': false, 'comments': false,
}

const firstNameElement = document.getElementById('firstName');
const lastNameElement = document.getElementById('lastName');
const emailIdElement = document.getElementById('emailId');
const phoneNumberElement = document.getElementById('phoneNumber');
const streetAddress1Element = document.getElementById('streetAddress1');
const streetAddress2Element = document.getElementById('streetAddress2');

const cityElement = document.getElementById('city');
const stateElement = document.getElementById('state');
const zipcodeElement = document.getElementById('zipcode');
const commentsElement = document.getElementById('comments');
const sourceElements = document.getElementsByName('source');

const drinkSelectElement = document.getElementById('drinks');
const drinksError = document.getElementById('drinks_error');
const drinkNameLabel = document.getElementById('drink_name_label');
const drinkCheckbox = document.getElementById('drink_name_checkbox');
const drinkCustomLabel = document.getElementById('drink_custom_label');
const drinkCustomText = document.getElementById('drink_custom_text');
const drinkCustomError = document.getElementById('drink_custom_error');

const disableSubmit = () => {
    let disableButton = true;
    for (const isValid in isValidForm) {
        disableButton = disableButton && isValidForm[isValid];
    }
    submitBtn.disabled = !disableButton;
}

const validateInput = (event) => {
    const input = event.target;
    const inputValue = input.value;
    const inputName = input.name;
    let isValid = inputValue.trim().length > 0;
    if (inputRegExs[inputName]) {
        isValid = inputValue.trim().match(inputRegExs[inputName]);
    }
    isValidForm[inputName] = isValid;
    const errorDivision = document.getElementById(`${inputName}_error`);
    if (errorDivision) {
        errorDivision.style.display = isValid ? 'none' : 'block';
    }
    disableSubmit();
};

const validateCheckbox = (event) => {
    const inputName = event.target.name;
    for (let i = 0; i < sourceElements.length; i++) {
        if(sourceElements[i].checked){
            isValidForm['source'] = true;
            break;
        }
        isValidForm['source'] = false;
    }

    const errorDivision = document.getElementById(`${inputName}_error`);
    if (errorDivision) {
        errorDivision.style.display = isValidForm[inputName] ? 'none' : 'block';
    }
    disableSubmit();
}

firstNameElement.addEventListener('focus', validateInput);
lastNameElement.addEventListener('focus', validateInput);
emailIdElement.addEventListener('focus', validateInput);
phoneNumberElement.addEventListener('focus', validateInput);
streetAddress1Element.addEventListener('focus', validateInput);
cityElement.addEventListener('focus', validateInput);
stateElement.addEventListener('focus', validateInput);
zipcodeElement.addEventListener('focus', validateInput);
commentsElement.addEventListener('focus', validateInput);

firstNameElement.addEventListener('blur', validateInput);
lastNameElement.addEventListener('blur', validateInput);
emailIdElement.addEventListener('blur', validateInput);
phoneNumberElement.addEventListener('blur', validateInput);
streetAddress1Element.addEventListener('blur', validateInput);
cityElement.addEventListener('blur', validateInput);
stateElement.addEventListener('blur', validateInput);
zipcodeElement.addEventListener('blur', validateInput);
commentsElement.addEventListener('blur', validateInput);

const handleDrinks = (event) => {
    const selectedValue = event.target.value;

    drinksError.style.display = selectedValue.length ? 'none' : 'block';
    drinkCheckbox.style.display = selectedValue.length ? 'block' : 'none';
    drinkNameLabel.style.display = selectedValue.length ? 'block' : 'none';
    drinkNameLabel.innerHTML = `${selectedValue} Large ($1 Extra)`;
    isValidForm[event.target.name] = selectedValue.length > 0;
    disableSubmit();
}

const handleDrinkSelection = (event) => {
    const checked = event.target.checked;
    drinkCustomLabel.style.display = checked ? 'block' : 'none';
    drinkCustomText.style.display = checked ? 'block' : 'none';

    if(checked && drinkCustomText.value.trim().length === 0) {
        drinkCustomError.style.display = 'block';
        submitBtn.disabled = true;
    } else {
        drinkCustomError.style.display = 'none';
        disableSubmit();
    }
}

const validateCustomization = (event) => {
    const selectedValue = event.target.value.trim();
    if(selectedValue.length === 0) {
        drinkCustomError.style.display = 'block';
        submitBtn.disabled = true;
    } else {
        drinkCustomError.style.display = 'none';
        disableSubmit();
    }
}
drinkSelectElement.addEventListener('change', handleDrinks);
drinkCheckbox.addEventListener('change', handleDrinkSelection);
drinkCustomText.addEventListener('focus', validateCustomization);
drinkCustomText.addEventListener('blur', validateCustomization);

sourceElements.forEach(sourceElement => {
    sourceElement.addEventListener('click', validateCheckbox);
});

function refreshForm() {
    window.location.reload();
}

const submitTable = () => {
    const titleElement = document.querySelector('input[name="title"]:checked');
    const table = document.createElement('table');
    let checkboxInitialString = '';
    sourceElements.forEach(sourceElement => {
         if(sourceElement.checked) {
             checkboxInitialString = checkboxInitialString + sourceElement.value + " ";
         }
    })
    table.innerHTML = `
        <caption>Submitted Form Result</caption>  
        <tbody>
            <tr>
                <td>Title</td>
                <td>${titleElement.value}</td>
            </tr>
            <tr>
                <td>First Name</td>
                <td>${firstNameElement.value}</td>
            </tr>
            <tr>
                <td>Last Name</td>
                <td>${lastNameElement.value}</td>
            </tr>
            <tr>
                <td>Email Id</td>
                <td>${emailIdElement.value}</td>
            </tr>
            <tr>
                <td>Phone Number</td>
                <td>${phoneNumberElement.value}</td>
            </tr>
            <tr>
                <td>Street Address 1</td>
                <td>${streetAddress1Element.value}</td>
            </tr>
            <tr>
                <td>Street Address 2</td>
                <td>${streetAddress2Element.value}</td>
            </tr>
            <tr>
                <td>City</td>
                <td>${cityElement.value}</td>
            </tr>
            <tr>
                <td>State</td>
                <td>${stateElement.value}</td>
            </tr>
            <tr>
                <td>ZipCode</td>
                <td>${zipcodeElement.value}</td>
            </tr>
            <tr>
                <td>How did you hear</td>
                <td>
                ${checkboxInitialString}</td>
            </tr>   
            <tr>
                <td>Drink</td>   
                <td>${drinkSelectElement.value}</td> 
            </tr>
            <tr>
                <td>${drinkNameLabel.textContent}</td>
                <td>${drinkCheckbox.checked ? 'Added' : 'Not Added'}</td> 
            </tr>
            <tr>
                <td>Any Additional Customization</td>
                <td>${drinkCheckbox.checked ? drinkCustomText.value: ""}</td> 
            </tr>
            <tr>
                <td>Comments</td>
                <td>${commentsElement.value}</td> 
            </tr>      
            <tr>
                <td colspan="2">
                    <button onclick="window.location.reload()"}>Go back to form</button>
                </td>
            </tr>  
        </tbody>
    `;
    document.getElementById('container').remove();
    document.body.append(table);

};

formElement.addEventListener('submit', submitTable);
resetBtn.addEventListener('click', refreshForm);
</script>
</body>
</html>